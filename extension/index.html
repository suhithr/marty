<!DOCTYPE html>
<html>
<head>
	<title></title>
	<!--  <script src="https://cdn.jsdelivr.net/webtorrent/latest/webtorrent.min.js"></script> -->
	<script src="static/jquery-1.12.1.js"></script>
	<script src="static/webtorrent.min.js"></script>
	<script type="text/javascript">
		var server = "http://415b1a40.ngrok.com"
		var str = ""
		function onUpload(files) {
			var client = new WebTorrent()

			console.log(files)

			client.seed(files, function(torrent) {
				console.log("YAY Seeding " + torrent.infoHash)
				console.log("YAY Magnet URI " + torrent.magnetURI)

				$.ajax({
					url: server + '/url',
					processData: true,
					type: "POST",
					async: true,
					mimeType: "application/json",
					cache: false,
					data: {"uri":torrent.magnetURI},
					success: function(data, textStatus, jqXHR) {
						console.log(data);
						document.getElementById("hash").setAttribute('value', data["hash"])
					}
				})
				// xhr.open("POST", server + '/url', true);
				// xhr.setRequestHeader("Content-type", "application/text");
				// // xhr.setRequestHeader("Access-Control-Allow-Origin", "*")
				// xhr.onreadystatechange = function() {
				// 	if (xhr.readyState == 4) {
				// 		console.log(xhr.responseText)
				// 		str = xhr.responseText
				// 		var responseData = JSON.parse(str)

				// 		document.getElementById("hash").setAttribute('value', responseData["hash"])
				// 	}
				// }
				// // xhr.send("uri=" + torrent.magnetURI);
				// xhr.send(JSON.stringify({uri: torrent.magnetURI}))
				
			})

		}
	</script>
</head>
<body>
	<input type="file" id="input" onchange="onUpload(this.files[0])">
	<br>
	<br>
	<input type="text" id="hash">
</body>
</html>